# Система управления цементным заводом

Полнофункциональная система для управления производством и ресурсами цементного завода с возможностью учета материалов, заводов, рабочих, заказов и поставщиков.

## Содержание

- [Особенности](#особенности)
- [Технологии](#технологии)
- [Архитектура](#архитектура)
- [Установка](#установка)
- [Запуск](#запуск)
- [Веб-интерфейс](#веб-интерфейс)
- [Консольный интерфейс](#консольный-интерфейс)
- [Структура проекта](#структура-проекта)
- [База данных](#база-данных)
- [Функциональность](#функциональность)

## Особенности

- **Двойной интерфейс**: веб и консольный интерфейсы для управления всеми аспектами системы
- **MongoDB репликасет**: отказоустойчивое хранение данных
- **Docker**: простая развертка базы данных
- **Модульная архитектура**: четкое разделение ответственности между компонентами

## Технологии

- **Backend**: Python 3.10+
- **Web-фреймворк**: Flask 3.0
- **База данных**: MongoDB 4.2 (репликасет из 3 узлов)
- **Контейнеризация**: Docker, Docker Compose
- **Фронтенд**: Bootstrap 5, HTML, CSS
- **ORM**: PyMongo для взаимодействия с MongoDB

## Архитектура

Система построена на основе модульной архитектуры:

- **Модели данных** (`models.py`): определение коллекций MongoDB
- **CRUD операции** (`crud.py`): операции создания, чтения, обновления и удаления данных
- **Подключение к БД** (`db_connect.py`): конфигурация соединения с MongoDB
- **Веб-приложение** (`app.py`): маршруты и обработчики Flask
- **Консольное приложение** (`main.py`): интерактивное меню в консоли
- **Форматированный вывод** (`pretty_print.py`): утилиты для красивого отображения данных
- **Автозаполнение** (`autofill.py`): скрипт для быстрого заполнения базы тестовыми данными

## Установка

### Предварительные требования

- Python 3.10+
- Docker и Docker Compose
- Git

### Шаги установки

1. Клонирование репозитория:
   ```bash
   git clone https://github.com/berrrchik/rsubd_practice8.git
   cd rsubd_practice8
   ```

2. Создание виртуального окружения:
   ```bash
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

3. Установка зависимостей:
   ```bash
   pip install -r requirements.txt
   ```

4. Запуск MongoDB через Docker Compose:
   ```bash
   docker-compose up -d
   ```

5. Инициализация репликасета:
   ```bash
   chmod +x replica-init.sh
   ./replica-init.sh
   ```

## Запуск

### Запуск веб-интерфейса

```bash
python app.py
```

Веб-интерфейс будет доступен по адресу: http://localhost:5000

### Запуск консольного интерфейса

```bash
python main.py
```

### Заполнение тестовыми данными

```bash
python autofill.py
```

## Веб-интерфейс

Веб-интерфейс предоставляет доступ ко всем функциям системы через браузер:

- **Главная страница**: доступ ко всем разделам системы
- **Материалы**: управление строительными материалами (добавление, удаление, поиск)
- **Заводы**: управление заводами (добавление, удаление)
- **Рабочие**: управление персоналом (добавление, удаление)
- **Заказы**: управление заказами на производство (добавление, удаление)
- **Поставщики**: управление поставщиками (добавление, удаление)

### Особенности веб-интерфейса

- Интуитивно понятная навигация
- Адаптивный дизайн на основе Bootstrap 5
- Формы с валидацией для добавления данных
- Табличное представление списков с возможностью удаления элементов
- Выпадающие списки для выбора связанных объектов

## Консольный интерфейс

Консольный интерфейс предоставляет те же функции, что и веб-интерфейс, но через командную строку:

```
--- МЕНЮ ПРОИЗВОДСТВА СТРОЙМАТЕРИАЛОВ ---
1. Материалы
2. Заводы
3. Рабочие
4. Заказы
5. Поставщики
6. Выход
```

В каждом подменю доступны следующие операции:
- Добавление новых записей
- Просмотр списка записей
- Удаление записей
- Сортировка по различным полям
- Для материалов: поиск по названию

## Структура проекта

```
cement_factory_practice/
├── app.py                # Веб-приложение на Flask
├── autofill.py           # Скрипт автозаполнения БД тестовыми данными
├── crud.py               # CRUD операции для всех моделей
├── db_connect.py         # Конфигурация подключения к MongoDB
├── docker-compose.yml    # Конфигурация Docker для MongoDB
├── main.py               # Консольное приложение
├── models.py             # Определение моделей данных
├── pretty_print.py       # Утилиты для форматированного вывода
├── replica-init.sh       # Скрипт инициализации репликасета
├── requirements.txt      # Зависимости проекта
├── README.md             # Документация
├── data/                 # Данные MongoDB (создается автоматически)
├── static/               # Статические файлы для веб-приложения
└── templates/            # HTML шаблоны для веб-приложения
    ├── layout.html       # Базовый шаблон
    ├── index.html        # Главная страница
    ├── materials.html    # Список материалов
    ├── add_material.html # Форма добавления материала
    └── ...               # Другие шаблоны
```

## База данных

### Модель данных

Система использует следующие коллекции MongoDB:

1. **materials**: Строительные материалы
   - `_id`: ObjectId (автогенерируемый)
   - `name`: Название материала
   - `description`: Описание материала

2. **factories**: Заводы
   - `_id`: ObjectId (автогенерируемый)
   - `name`: Название завода
   - `location`: Местоположение
   - `supplier_id`: Ссылка на поставщика (ObjectId)

3. **workers**: Рабочие
   - `_id`: ObjectId (автогенерируемый)
   - `name`: Имя рабочего
   - `factory_id`: Ссылка на завод (ObjectId)

4. **production_orders**: Заказы на производство
   - `_id`: ObjectId (автогенерируемый)
   - `material_id`: Ссылка на материал (ObjectId)
   - `quantity`: Количество
   - `order_date`: Дата заказа

5. **suppliers**: Поставщики
   - `_id`: ObjectId (автогенерируемый)
   - `name`: Название поставщика
   - `contact`: Контактная информация

### MongoDB Репликасет

Система использует MongoDB репликасет из трех узлов для обеспечения высокой доступности:

- **mongo1**: первичный узел (порт 30001)
- **mongo2**: вторичный узел (порт 30002)
- **mongo3**: вторичный узел (порт 30003)

## Функциональность

### Материалы

- Добавление нового материала с названием и описанием
- Просмотр списка всех материалов
- Удаление материала по ID
- Поиск материалов по названию (с поддержкой регулярных выражений)
- Сортировка материалов по различным полям

### Заводы

- Добавление нового завода с названием, местоположением и связью с поставщиком
- Просмотр списка всех заводов
- Удаление завода по ID
- Сортировка заводов по различным полям

### Рабочие

- Добавление нового рабочего с именем и связью с заводом
- Просмотр списка всех рабочих
- Удаление рабочего по ID
- Сортировка рабочих по различным полям

### Заказы

- Добавление нового заказа с указанием материала, количества и автоматической датой
- Просмотр списка всех заказов
- Удаление заказа по ID
- Сортировка заказов по различным полям

### Поставщики

- Добавление нового поставщика с названием и контактной информацией
- Просмотр списка всех поставщиков
- Удаление поставщика по ID
- Сортировка поставщиков по различным полям 